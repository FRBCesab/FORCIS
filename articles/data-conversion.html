<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data conversion • forcis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data conversion">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">forcis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/forcis.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/sampling-devices.html">Sampling devices</a></li>
    <li><a class="dropdown-item" href="../articles/database-versions.html">Database versions</a></li>
    <li><a class="dropdown-item" href="../articles/select-and-filter-data.html">Select, reshape, and filter data</a></li>
    <li><a class="dropdown-item" href="../articles/data-conversion.html">Data conversion</a></li>
    <li><a class="dropdown-item" href="../articles/data-visualization.html">Data visualization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/FRBCesab/forcis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data conversion</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FRBCesab/forcis/blob/master/vignettes/data-conversion.Rmd" class="external-link"><code>vignettes/data-conversion.Rmd</code></a></small>
      <div class="d-none name"><code>data-conversion.Rmd</code></div>
    </div>

    
    
<p>The package <code>forcis</code> provides <a href="https://frbcesab.github.io/forcis/reference/index.html#standardization-functions">functions</a>
to homogenize FORCIS data and compute abundances, concentrations, and
frequencies of foraminifera counts. This vignette shows how to use these
functions.</p>
<div class="section level2">
<h2 id="count-formats-within-forcis">Count formats within FORCIS<a class="anchor" aria-label="anchor" href="#count-formats-within-forcis"></a>
</h2>
<p>The FORCIS database includes counts of foraminifera species collected
with multiple devices. These counts are reported in different
formats:</p>
<ul>
<li>
<strong>Raw abundance</strong>: number of specimens counted within a
sampling unit.</li>
<li>
<strong>Number concentration</strong>: number of specimens per cubic
meter.</li>
<li>
<strong>Relative abundance</strong>: percentage of specimens
relative to the total counted</li>
<li>
<strong>Fluxes</strong>: number of specimens per square meter per
day.</li>
<li>
<strong>Binned counts</strong>: number of specimens categorized into
a specific range (minimum and maximum) within a sampling unit.</li>
</ul>
</div>
<div class="section level2">
<h2 id="conversion-functions">Conversion functions<a class="anchor" aria-label="anchor" href="#conversion-functions"></a>
</h2>
<p>The functions detailed in this vignette allow to convert counts
between the following formats <strong>Raw abundance</strong>,
<strong>Relative abundance</strong> and <strong>Number
concentration</strong>.</p>
<blockquote>
<p><strong>NOTE:</strong> FORCIS data from <em>Sediment traps</em> and
the <em>CPR North</em> are not supported by these functions.</p>
</blockquote>
<p>First, let’s import the required package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://frbcesab.github.io/forcis">forcis</a></span><span class="op">)</span></span></code></pre></div>
<p>Before going any further, we will download the latest version of the
FORCIS database.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data/ folder ----</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download latest version of the database ----</span></span>
<span><span class="fu"><a href="../reference/download_forcis_db.html">download_forcis_db</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data"</span>, version <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The vignette will use the plankton nets data of the FORCIS database.
Let’s import the latest release of the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import net data ----</span></span>
<span><span class="va">net_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_plankton_nets_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p><strong>NB:</strong> In this vignette, we use a subset of the
plankton nets data, not the whole dataset.</p>
<p>After importing the data, the initial step involves choosing the
taxonomic level for the analyses, (the different taxonomic levels are
described in this <a href="https://www.nature.com/articles/s41597-023-02264-2" class="external-link">data paper</a>
).</p>
<p>Let’s use the function <code><a href="../reference/select_taxonomy.html">select_taxonomy()</a></code> to select the
<strong>VT</strong> taxonomy (validated taxonomy):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select taxonomy ----</span></span>
<span><span class="va">net_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_taxonomy.html">select_taxonomy</a></span><span class="op">(</span><span class="va">net_data</span>, taxonomy <span class="op">=</span> <span class="st">"VT"</span><span class="op">)</span></span></code></pre></div>
<p>Once the data contains counts from the same taxonomic level, we can
proceed with the conversion functions: <code>compute_*()</code>.</p>
<p>The functions accept two arguments: the input <code>data</code> and
the <code>aggregate</code> argument. If <code>aggregate = TRUE</code>,
the function will return the transformed counts of each species using
the sample as the unit. If <code>aggregate = FALSE</code>, it will
re-calculate the species’ abundance by subsample.</p>
<div class="section level3">
<h3 id="compute_abundances">
<code>compute_abundances()</code><a class="anchor" aria-label="anchor" href="#compute_abundances"></a>
</h3>
<p>This function converts all counts into raw abundances, using sampling
metadata such as sample volume and total assemblage counts. It
calculates the raw abundance for each taxon whose counts are reported as
either relative abundance or number concentrations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert species counts in raw abundance ----</span></span>
<span><span class="va">net_data_raw_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computations.html">compute_abundances</a></span><span class="op">(</span><span class="va">net_data</span>, aggregate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Counts from 26 samples could not be converted because of missing volume data</span></span>
<span><span class="co">#&gt; Relative counts from 24 samples could not be converted because of missing data on total assemblage</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Format ----</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">net_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2451   77</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">net_data_raw_ab</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 39032    16</span></span>
<span></span>
<span><span class="co"># Header ----</span></span>
<span><span class="va">net_data_raw_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">net_data_raw_ab</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">net_data_raw_ab</span><span class="op">)</span></span>
<span><span class="co">#&gt;   data_type    cruise_id            profile_id sample_id sample_min_depth</span></span>
<span><span class="co">#&gt; 1       Net RinaldoDohrn L20_RinaldoDohrn_10_1  L20_10_1                0</span></span>
<span><span class="co">#&gt; 2       Net RinaldoDohrn L20_RinaldoDohrn_10_1  L20_10_1                0</span></span>
<span><span class="co">#&gt; 3       Net RinaldoDohrn L20_RinaldoDohrn_10_1  L20_10_1                0</span></span>
<span><span class="co">#&gt; 4       Net RinaldoDohrn L20_RinaldoDohrn_10_1  L20_10_1                0</span></span>
<span><span class="co">#&gt; 5       Net RinaldoDohrn L20_RinaldoDohrn_10_1  L20_10_1                0</span></span>
<span><span class="co">#&gt; 6       Net RinaldoDohrn L20_RinaldoDohrn_10_1  L20_10_1                0</span></span>
<span><span class="co">#&gt;   sample_max_depth profile_depth_min profile_depth_max profile_date_time</span></span>
<span><span class="co">#&gt; 1               20                 0               300        09/04/1979</span></span>
<span><span class="co">#&gt; 2               20                 0               300        09/04/1979</span></span>
<span><span class="co">#&gt; 3               20                 0               300        09/04/1979</span></span>
<span><span class="co">#&gt; 4               20                 0               300        09/04/1979</span></span>
<span><span class="co">#&gt; 5               20                 0               300        09/04/1979</span></span>
<span><span class="co">#&gt; 6               20                 0               300        09/04/1979</span></span>
<span><span class="co">#&gt;   cast_net_op_m2 sample_segment_length site_lat_start_decimal</span></span>
<span><span class="co">#&gt; 1             NA                    NA                   40.7</span></span>
<span><span class="co">#&gt; 2             NA                    NA                   40.7</span></span>
<span><span class="co">#&gt; 3             NA                    NA                   40.7</span></span>
<span><span class="co">#&gt; 4             NA                    NA                   40.7</span></span>
<span><span class="co">#&gt; 5             NA                    NA                   40.7</span></span>
<span><span class="co">#&gt; 6             NA                    NA                   40.7</span></span>
<span><span class="co">#&gt;   site_lon_start_decimal sample_volume_filtered            taxa counts_raw_ab</span></span>
<span><span class="co">#&gt; 1                  15.08                   1000   b_digitata_VT             0</span></span>
<span><span class="co">#&gt; 2                  15.08                   1000    b_pumilio_VT             0</span></span>
<span><span class="co">#&gt; 3                  15.08                   1000 b_variabilis_VT             0</span></span>
<span><span class="co">#&gt; 4                  15.08                   1000     c_nitida_VT             0</span></span>
<span><span class="co">#&gt; 5                  15.08                   1000   d_anfracta_VT             0</span></span>
<span><span class="co">#&gt; 6                  15.08                   1000     g_adamsi_VT             0</span></span></code></pre></div>
<p>The functions <code>compute_*()</code> output a table in a
long-format as well as a message reporting the amount of data that could
not be converted because of missing metadata.</p>
<div class="section level4">
<h4 id="compute_concentrations">
<code>compute_concentrations()</code><a class="anchor" aria-label="anchor" href="#compute_concentrations"></a>
</h4>
<p>This function transforms all counts into number concentration
abundances. It also leverages sampling metadata such as sample volume
and total assemblage counts to compute the number concentration for each
species.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert species counts in number concentration ----</span></span>
<span><span class="va">net_data_n_conc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computations.html">compute_concentrations</a></span><span class="op">(</span><span class="va">net_data</span>, aggregate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Counts from 14 samples could not be converted because of missing volume data</span></span>
<span><span class="co">#&gt; Relative counts from 24 samples could not be converted because of missing data on total assemblage</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="compute_frequencies">
<code>compute_frequencies()</code><a class="anchor" aria-label="anchor" href="#compute_frequencies"></a>
</h4>
<p>This function computes relative abundance for each species using
total assemblage counts when available.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert species counts in relative abundance ----</span></span>
<span><span class="va">net_data_rel_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computations.html">compute_frequencies</a></span><span class="op">(</span><span class="va">net_data</span>, aggregate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Counts from 12 samples could not be converted because of missing volume data</span></span>
<span><span class="co">#&gt; Counts from 0 samples could not be converted because of missing data on total assemblage</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicolas Casajus, Mattia Greco, Xavier Giraud, Sonia Chaabane.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
